name: Watch Workflow Status
on:
  workflow_run:
    workflows: [ "Created", "Deploy::CDN", "Deploy::SSR", "Deploy::Static", "Deploy::Addone", "Deploy::Package" ]
    branches: [ main, master ]
    types: [ completed ]
env:
  WECHAT_WORK_BOT_WEBHOOK: ${{secrets.WECHAT_WORK_BOT_WEBHOOK}}

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - id: prep
        uses: hocgin/action-env@main
      - name: WeChat Work Notification
        uses: chf007/action-wechat-work@master
        env:
          WECHAT_WORK_BOT_WEBHOOK: ${{env.WECHAT_WORK_BOT_WEBHOOK}}
        with:
          msgtype: markdown
          content: "**ã€[${{ steps.prep.outputs.repo_full_name }}](${{ steps.prep.outputs.repo_html_url }})ã€‘** \n
          ğŸ“Œ ${{ github.event.workflow_run.conclusion == 'success' && 'â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸' || 'ğŸŒ§ï¸ğŸŒ§ï¸ğŸŒ§ï¸ğŸŒ§ï¸ğŸŒ§ï¸' }} \n
          ğŸƒ [@${{ steps.prep.outputs.sender }}](${{ steps.prep.outputs.sender_html_url }})\n
          ğŸ• <font color=\"comment\">${{ steps.prep.outputs.action_trigger_at }}</font> \n
          ğŸ”§ <font color=\"warning\">${{ steps.prep.outputs.source_branch || 'âˆ…' }} -> ${{ steps.prep.outputs.target_branch || 'âˆ…' }}</font> \n
          ğŸ† <font color=\"comment\">${{ steps.prep.outputs.env || 'æœªçŸ¥ç‰ˆæœ¬' }} / ${{ steps.prep.outputs.version || 'æœªçŸ¥ç‰ˆæœ¬' }}</font> \n
          ğŸ“ [æäº¤ä¿¡æ¯](${{ steps.prep.outputs.commit_html_url }}) \n
          \n
          [æŸ¥çœ‹æ›´å¤š](${{ steps.prep.outputs.repo_homepage || steps.prep.outputs.repo_html_url }})
          "
